# 립 시뮬레이션 엔진 핵심 요구사항 명세서 (Core Rendering Engine)

## 1. 프로젝트 목표
사용자의 입술 이미지를 바탕으로 입술의 3차원 기하학적 구조를 추정(Fake Normal)하고, 이를 활용해 물리 기반의 자연스러운 광택(Gloss)과 하이라이트를 생성하는 핵심 렌더링 엔진을 구현합니다. 본 명세서에서는 단순 컬러 합성이나 특수 효과를 제외한 **렌더링 인프라와 물리 구조**에 집중합니다.

## 2. 핵심 렌더링 인프라 요구사항

### 2.1 입술 기하학적 구조 추정 (Fake Normal Mapping)
- **좌표계 정규화**:
    - 입술 랜드마크를 기반으로 입술 영역 내 상대 좌표계($\hat{x}, \hat{y}$)를 생성해야 함.
    - 윗입술과 아랫입술을 분리하여 각각의 곡률을 반영할 수 있는 독립적 좌표 체계 구축.
- **법선 벡터(Normal Vector) 생성**:
    - 픽셀 단위의 경사도(Gradient)를 계산하여 입술의 입체감을 표현하는 Normal Map($N_x, N_y, N_z$)을 생성.
    - **Liquid Blur**: 입술 표면의 미세한 주름을 완화하고 매끄러운 질감을 만들기 위한 가우시안 블러 처리 로직 포함.
    - **Height Gain**: 입술의 돌출 정도(볼륨감)를 조절할 수 있는 파라미터화된 물리 연산.

### 2.2 물리 기반 하이라이트 생성 (Phong Reflection Model 기반)
- **광원 모델링**: 3차원 공간상의 광원 방향($L_{dir}$)을 정의하고 이를 Normal Map과 연산.
- **Specular 하이라이트**:
    - 입술의 곡률에 따라 빛이 반사되는 지점을 계산.
    - **Shininess**: 반사광의 집중도/날카로움을 제어하는 파워 함수(Exponent) 구현.
    - **Strength**: 반사광의 전체적인 강도 제어.
- **Clear Coat 레이어**:
    - 표면 위에 투명한 코팅막이 씌워진 듯한 이중 반사 효과(Fresnel 유사 효과) 구현.
    - 코팅막의 두께와 강도를 독립적으로 제어.

### 2.3 마스크 및 페더링 (Geometry Control)
- **정밀 마스크**: 랜드마크를 연결하는 부드러운 폐곡선 마스크 생성.
- **Feathering (Outward Falloff)**: 
    - 입술 경계선에서 바깥쪽으로 부드럽게 감쇄하는 가중치 맵 생성.
    - 경계의 날카로움을 제어하여 합성 시의 부자연스러운 계단 현상 방지.

## 3. 제어 및 인터페이스 요구사항

### 3.1 물리 파라미터 제어
- 다음과 같은 핵심 물리 속성들을 실시간으로 조절 가능한 구조로 설계:
    - `LIQUID_BLUR_SIGMA`: 표면 매끄러움 정도
    - `HEIGHT_GAIN`: 입술 볼륨감
    - `SPEC_STRENGTH`: 기본 광택 강도
    - `SHININESS`: 하이라이트 집중도
    - `CLEAR_STRENGTH`: 코팅 레이어 강도
    - `LIGHT_DIR`: 3D 광원 방향 (Vector3)

### 3.2 하이라이트 형상 제어 (Highlight Shape)
- 윗입술과 아랫입술의 하이라이트 중심점(`UPPER_CENTER`, `LOWER_CENTER`)을 좌표계 상에서 이동시킬 수 있는 로직.

## 4. 품질 및 구현 원칙
- **기술적 순수성**: 언어나 라이브러리에 의존하지 않는 순수 수치 연산(Linear Algebra) 중심의 로직 설계.
- **물리적 일관성**: 광원 방향 변경 시 모든 하이라이트와 쉐딩이 일관되게 변화해야 함.
- **확장성**: 추후 컬러 블렌딩 모듈이 추가될 때 하이라이트 레이어와 쉽게 결합 가능한 레이어 구조 유지.

---
> [!IMPORTANT]
> 본 명세서는 단순한 '필터'가 아닌, 이미지 데이터로부터 **물리적 구조를 재구성하는 엔진**을 지향합니다.
