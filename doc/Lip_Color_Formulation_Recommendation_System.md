# Lip Color & Formulation Recommendation System
## LAB 기반 얼굴–립 매칭 및 자동 추천 엔진

(설계 문서 초안)

---

## 1. 개요 (Overview)

본 시스템은 단일 인물의 얼굴 이미지를 입력으로 받아,
실제 제형 촬영 이미지를 기준으로 한 립 제품 데이터베이스와 비교하여
해당 인물에게 색상과 제형이 동시에 가장 잘 어울리는 립 제품 Top 3를
정량적 점수와 설명과 함께 추천하는 것을 목표로 한다.

본 시스템은 다음 원칙을 따른다.

- 색 판단은 LAB 색공간 기반 절대 점수
- 얼굴 색은 단일 값이 아닌 범위(Distribution)
- 제형(Formulation)은 색 판단의 보정 축
- 퍼스널 컬러는 설명 및 해석 레이어
- 모든 판단은 측정 가능하고 설명 가능해야 한다

---

## 2. 입력 조건 및 촬영 환경 전제

### 2.1 얼굴 이미지 입력 조건

- 단일 이미지 입력
- 기계적으로 고정된 조명 환경
- 조명 밝기 및 색온도 고정
- 카메라 White Balance는 조명 색온도와 정확히 매칭
- 촬영 거리 및 노출 조건 반복 가능

본 시스템은 색 보정이나 조명 추정을 수행하지 않으며,
측정된 색값을 신뢰 가능한 입력으로 전제한다.

---

## 3. 얼굴 색 분석 방법

### 3.1 얼굴 색의 정의

얼굴 색은 단일 평균값이 아닌,
LAB 색공간 상의 분포(Envelope)로 정의한다.

Face Color Profile:
- 중심값 (L̄, ā, b̄)
- 분산 (σ_L, σ_C)

---

### 3.2 분석 영역 및 제외 영역

제외 영역:
- 눈
- 입술
- 콧구멍 내부
- 머리카락
- 과도한 하이라이트 영역
- 짙은 음영 영역

분석 영역:
- 볼 (Cheek)
- 이마 (Forehead)
- 턱 (Chin)
- 콧등 (Nose bridge, 보조적)

---

### 3.3 랜드마크 기반 영역 정의

- 얼굴 영역은 facial landmark 기반 ROI로 정의
- 픽셀 단위 세그멘테이션이 아닌 해부학적 상대 위치 기준
- 각 영역의 중앙부 픽셀만 샘플링하여 경계 노이즈 제거

---

### 3.4 영역별 가중 평균 (논문 기반)

| 영역 | 가중치 | 역할 |
|----|----|----|
| 볼 | 0.45 | 얼굴 색 대표값 |
| 이마 | 0.25 | 명도 기준 |
| 턱 | 0.20 | 대비 허용 판단 |
| 콧등 | 0.10 | 분산 보조 |

---

## 4. 얼굴 특성 지표 (Face Characteristics)

얼굴 특성은 주관적 해석이 아닌,
색 분포로부터 계산되는 정량 지표로 정의한다.

- 명도 범위 (σ_L): 명도 변화 허용도
- 대비 허용도 (ΔL_face): 얼굴 내부 명도 대비 폭
- 채도 안정성 (σ_C): 채도 변화 수용 능력

---

## 5. 립 컬러 기준 데이터

- 립 컬러는 실제 제형 촬영 이미지에서 측정
- 렌더 결과를 기준색으로 사용하지 않음
- 제품별 LAB 분포 저장

---

## 6. 색 매칭 점수 (Core Color Match Score)

- LAB 색공간 기반
- ΔE2000 중심
- 얼굴 LAB 분포와 제품 LAB 분포 간 거리 계산
- 절대 점수 (0–100)

색 점수는 추천 점수의 주된 결정 요인이다.

---

## 7. 제형(Formulation) 보정 축

- 제형은 색을 바꾸지 않음
- 색이 얼굴에서 어떻게 인지되는지를 보정
- 대비, 명도 체감, 채도 인상에 영향
- 보정 범위는 ±10점 이내

---

## 8. 퍼스널 컬러 레이어

- 퍼스널 컬러는 설명용 레이어
- LAB 색공간 상 영역(Envelope)로 정의
- 얼굴 LAB 분포와의 겹침률로 판단

---

## 9. 최종 추천 점수 구조

Final Score =
Color Match Score
+ Formulation Adjustment
+ Personal Color Bias

---

## 10. 출력 결과

- 최종 점수
- 색 적합성 설명
- 제형 보정 설명
- 퍼스널 컬러 관점 설명
- 스펙트럼 위치

---

## 11. 시스템 철학

색은 판단하고,
제형은 조정하며,
퍼스널 컬러는 설명한다.
